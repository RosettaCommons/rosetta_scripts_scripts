<ROSETTASCRIPTS>
Keywords: SEWING, protein interface design, single sided design, enzyme design
Author: Brahm Yachnin
Email: brahm.yachnin@rutgers.edu

Starting with a short helix that we have found to autoinhibit carboxypeptidease G2,
this script extends that helix using SEWING (AppendAssembly), adapted using suggestions from
Sharon Guffy and Frank Teets (Kuhlman lab).  Because of a number of issues with
multichain proteins and zinc-containing proteins, the protocol works as follows:
-Start with the inhibitory helix (prodomain) alone as the input PDB.
-Run AppendAssemblyMover SEWING, using the CPG2 "scaffold" as the partner_pdb.  The
 last residue of the scaffold-prodomain is removed from the partner_pdb to prevent the 
 SEWING mover from thinking it's a clash.
-Add the CPG2 "scaffold" as new chains, and connect chain A of the scaffold to chain B
 (the prodomain).
-Do a repack/design and cartesian minimization to relieve clashes.
-Do FastDesign for more extensive design with small backbone movements.
This script runs the SEWING part, and a companion script does the design part.  This allows us to
keep the SEWING scoreterms in the scorefile.
	<SCOREFXNS>
		<ScoreFunction name="ref" weights="ref2015.wts"/>
	</SCOREFXNS>
	
	<RESIDUE_SELECTORS>
		<And name="dockchain">
			<Chain chains="B"/>
			<Not>
				<ResidueName residue_name3="ZN"/>
			</Not>
		</And>
		
		<Not name="scaffoldzn" selector="dockchain"/>
		
		<Index name="cat_glu" resnums="411B"/>
	</RESIDUE_SELECTORS>
	
	<TASKOPERATIONS>	
		<OperateOnResidueSubset name="dontrepackscaffold">
			<Chain chains="A,C"/>
			<PreventRepackingRLT/>
		</OperateOnResidueSubset>
		
		<OperateOnResidueSubset name="nodesignscaffold" selector="scaffoldzn">
			<RestrictToRepackingRLT/>
		</OperateOnResidueSubset>
	</TASKOPERATIONS>
	
	<FILTERS>
		<PackStat name="packstat" threshold="0.50" chain="1"/>
		<BuriedUnsatHbonds name="buriedunsat" scorefxn="ref" jump_number="0" cutoff="200" task_operations="dontrepackscaffold"/>cutoff=20
		<CavityVolume name="cavvolume"/>
		<SSShapeComplementarity name="shapecomp" residue_selector="dockchain" verbose="1" min_sc="0.0"/>
		<SSPrediction name="sspred" threshold="0.35" use_svm="1" use_probability="1" mismatch_probability="1" confidence="0"/>
		<SecondaryStructureHasResidue name="require_core" confidence="0" ss_select_task_operations="nodesignscaffold"/>
		<FragmentLookupFilter name="fragment_lookup" lookup_name="source_fragments_4_mer" store_path="VALL_clustered/backbone_profiler_database_06032014"
		 lookup_mode="first" chain="1" threshold="0" confidence="1" />
		<ResidueCount name="nres_b" residue_selector="dockchain" min_residue_count="0" max_residue_count="1000"/>
	</FILTERS>
	<MOVERS>
		<AppendAssemblyMover name="aam" model_file_name="smotifs_H_5_40_L_1_6_H_5_40.segments" hashed="false"
			add_probability="0.9" delete_probability = "0.1" max_segments = "9" minimum_cycles = "1000"
			maximum_cycles = "1100" modifiable_terminus = "C" output_pose_per_move = "false"
			partner_pdb="cpg2-gstevg-_chains.pdb" required_selector="cat_glu" output_partner="0">
			pose_segment_starts="403" pose_segment_ends="419" required_resnums = "21"
			<AssemblyScorers>
				<MotifScorer weight = "1" />
				<InterModelMotifScorer weight = "10" />
				<PartnerMotifScorer weight = "2" />
				
				<SubsetPartnerMotifScorer weight="10" region_start="23" region_end="26"/>
				<SubsetPartnerMotifScorer weight="10" region_start="109" region_end="120"/>
				<SubsetPartnerMotifScorer weight="10" region_start="267" region_end="270"/>
				<SubsetPartnerMotifScorer weight="10" region_start="291" region_end="297"/>
				<SubsetPartnerMotifScorer weight="10" region_start="543" region_end="545"/>
				<SubsetPartnerMotifScorer weight="10" region_start="586" region_end="590"/>
			</AssemblyScorers>
			<AssemblyRequirements>
				<ClashRequirement clash_radius = "4" />
				<LengthInResiduesRequirement minimum_length="25" maximum_length="70"/>
			</AssemblyRequirements>
		</AppendAssemblyMover> 
	</MOVERS>
	<PROTOCOLS>
		<Add mover_name="aam" />
	
		Add some filters
		<Add filter_name="packstat"/>
		<Add filter_name="buriedunsat"/>
		<Add filter_name="cavvolume"/>Cavity volume doesn't work with the selector.
		<Add filter_name="shapecomp"/>
		<Add filter_name="sspred"/>
		<Add filter_name="require_core"/>
		<Add filter_name="nres_b"/>
		<Add filter_name="fragment_lookup"/>
	</PROTOCOLS>
</ROSETTASCRIPTS>
