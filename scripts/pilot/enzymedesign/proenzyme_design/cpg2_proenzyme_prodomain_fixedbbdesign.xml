<ROSETTASCRIPTS>
Keywords: protein interface design, single sided design, enzyme design
Author: Brahm Yachnin
Email: brahm.yachnin@rutgers.edu

This script's purpose is to increase the diversity of prodomain designs of CPG2 by
doing fixed backbone design on the prodomain.  The corresponding hbnet script will
run a similar protocol, but includes explicit H-bond network design.  The input for
this protocol is a "pro-CPG2" design, typically made using hotspot "docking" of an
existing small domain or using SEWING to de novo design a backbone.  The starting
model be relaxed.  The prodomain is expected to be chain B, with the inhibited domain
as chain A and the other protomer being chain C.  A foldtree file should be generated
to explicitly connect chain A and B.  The protocol works as follows:
-Connect chain A of the scaffold to chain B (the prodomain), and apply foldtree.
-Add match csts and pack and minimize catalytic residues.  Filter for cst energy and total score.
-Do a series of design and minimization steps.
-Apply appropriate filters.

NOTE: The residue ids should be changed in the following residue selectors and task operations
to match the appropriate residues in the input structure:
-
	<SCOREFXNS>
		<ScoreFunction name="ref" weights="ref2015.wts"/>
		<ScoreFunction name="ref_cst" weights="ref2015_cst.wts"/>
		<ScoreFunction name="ref_cst_cart" weights="ref2015_cart.wts">
			<Reweight scoretype="angle_constraint" weight="1.0"/>
			<Reweight scoretype="atom_pair_constraint" weight="1.0"/>
			<Reweight scoretype="chainbreak" weight="1.0"/>
			<Reweight scoretype="coordinate_constraint" weight="1.0"/>
			<Reweight scoretype="dihedral_constraint" weight="1.0"/>
			<Reweight scoretype="res_type_constraint" weight="1.0"/>
		</ScoreFunction>
		<ScoreFunction name="ref_soft" weights="ref2015_soft.wts">
			<Reweight scoretype="angle_constraint" weight="1.0"/>
			<Reweight scoretype="atom_pair_constraint" weight="1.0"/>
			<Reweight scoretype="chainbreak" weight="1.0"/>
			<Reweight scoretype="coordinate_constraint" weight="1.0"/>
			<Reweight scoretype="dihedral_constraint" weight="1.0"/>
			<Reweight scoretype="res_type_constraint" weight="1.0"/>
		</ScoreFunction>
		<ScoreFunction name="ref_cst_output" weights="ref2015_cst.wts">
			<Reweight scoretype="res_type_constraint" weight="0.0"/>
		</ScoreFunction>
	</SCOREFXNS>
	
	<RESIDUE_SELECTORS>			
		<And name="dockchain">
			<Chain chains="B"/>
			<Not>
				<ResidueName residue_name3="ZN"/>
			</Not>
		</And>
		
		<ResidueName name="zns" residue_name3="ZN"/>
		
		<Not name="scaffoldzn" selector="dockchain"/>
			
		<Or name="corecontact">
			<Chain chains="B"/>
			<Index resnums="29A,88A,89A,90A,91A,113A,237A,272A,298A"/>
		</Or>
		
		<Index name="linkerres" resnums="394A,395A,396A,397A,398A,399A,400A,401A,402A,403A,404A,405A,406A"/>

		<Or name="linkdomain" selectors="linkerres,dockchain"/>
		<Neighborhood name="aroundaddition" selector="linkdomain" distance="5.0"/>
	</RESIDUE_SELECTORS>
	
	<TASKOPERATIONS>
		<InitializeFromCommandline name="init"/>
		<IncludeCurrent name="inccurrent"/>
		<ExtraRotamersGeneric name="ex" ex1="1" ex2="1" ex1aro="1" ex1_sample_level="1" ex2_sample_level="1" ex1aro_sample_level="1" extrachi_cutoff="1"/>
		
		<RestrictToRepacking name="designoff"/>
		<SetCatalyticResPackBehavior name="catdesignoff" fix_catalytic_aa="0"/>
		<SetCatalyticResPackBehavior name="fixcat" fix_catalytic_aa="1"/>
		<SetCatalyticResPackBehavior name="freeze-noncat" fix_catalytic_aa="0" behavior_non_catalytic="NATRO"/>

		<OperateOnResidueSubset name="fixdockchain" selector="dockchain">
			<PreventRepackingRLT/>
		</OperateOnResidueSubset>

		<OperateOnResidueSubset name="fixawayaddition">
			<Not selector="aroundaddition"/>
			<PreventRepackingRLT/>
		</OperateOnResidueSubset>
		
		<OperateOnResidueSubset name="fixlinker" selector="linkerres">
			<PreventRepackingRLT/>
		</OperateOnResidueSubset>
		
		<OperateOnResidueSubset name="repackcoreonly">
			<Not>
				<Or>
					<Chain chains="B"/>
					<Index resnums="29A,88A,89A,90A,91A,113A,237A,272A,298A"/>
				</Or>
			</Not>
			<PreventRepackingRLT/>
		</OperateOnResidueSubset>

		<OperateOnResidueSubset name="designonly_b_interface">
			<Not>
				<Neighborhood distance="8.0" selector="dockchain"/>
			</Not>
			<PreventRepackingRLT/>
		</OperateOnResidueSubset>
		
		<OperateOnResidueSubset name="nodesignscaffold" selector="scaffoldzn">
			<RestrictToRepackingRLT/>
		</OperateOnResidueSubset>
		
		<OperateOnResidueSubset name="designlinkeronly">
			<Not selector="linkerres"/>
			<PreventRepackingRLT/>
		</OperateOnResidueSubset>
		
		Design restriction task ops
		<DisallowIfNonnative name="dontaddGPC" resnum="0" disallow_aas="GCP"/>
		<RestrictIdentities name="dontremGPC" identities="GLY,CYS,PRO" prevent_repacking="0"/>
		<DsspDesign name="designbyss"/>
	</TASKOPERATIONS>
	
	<FILTERS>
		<EnzScore name="cstE" scorefxn="ref_cst" whole_pose="1" score_type="cstE" energy_cutoff="20.0"/>
		<AtomicContactCount name="contactcountdef" partition="chain" distance="4.5" task_operations="repackcoreonly"/>
		<IfThenFilter name="contactcount" threshold="6" lower_threshold="true">
			<IF testfilter="contactcountdef" valuefilter="contactcountdef"/>
		</IfThenFilter>
		
		<BuriedUnsatHbonds name="buriedhbonds" scorefxn="ref_cst" jump_number="1" task_operations="designonly_b_interface" cutoff="20"/>
		<Rmsd name="rmsd_chainb" chains="B" threshold="1" superimpose="1"/>
		
		<ScoreType name="total" scorefxn="ref_cst_output" threshold="-2000"/>
		<ScoreType name="farep" scorefxn="ref" score_type="fa_rep" threshold="600"/>

		Report filters
		Report name="cstE_start" filter="cstE"/>
		
		Diagnostic filters
		PoseInfo name="poseinfo"/>
		DesignableResidues name="designableres" task_operations="catdesignoff" designable="1" packable="1"/>
		DesignableResidues name="designableres-NATRO" task_operations="freeze-noncat" designable="1" packable="1"/>
	</FILTERS>
	
	<MOVERS>
		Constraint stuff
		<FavorNativeResidue name="favournative" bonus="2.0"/>
		<AddOrRemoveMatchCsts name="addmatchcsts" cst_instruction="add_new" cstfile="1cg2_zn_dimer_pluscomp.cst" accept_blocks_missing_header="0"/>
		<ClearConstraintsMover name="removecsts"/>
		
		<MutateResidue name="a_k177a" target="90A" new_res="ALA"/>
		
		<MutateResidue name="resetzns" residue_selector="zns" new_res="ZN" preserve_atom_coords="1"/>
		
		Repack and min catalytic
		<PackRotamersMover name="packcatalytic" scorefxn="ref_cst" task_operations="init,inccurrent,ex,freeze-noncat,designoff"/>
		<TaskAwareMinMover name="mincatalytic"  scorefxn="ref_cst" task_operations="init,inccurrent,ex,freeze-noncat" chi="1" bb="0" jump="0"/>
		
		Main design mover
		<PackRotamersMover name="designchainb" scorefxn="ref_cst" task_operations="init,inccurrent,ex,designonly_b_interface,nodesignscaffold,catdesignoff,dontaddGPC,dontremGPC,designbyss"/>
		
		Minimization movers
			Regular minimization
			<TaskAwareMinMover name="minchainb" scorefxn="ref_cst" chi="1" bb="0" jump="0" task_operations="init,inccurrent,ex,designonly_b_interface,nodesignscaffold,catdesignoff"/>
			Rigid body min of the inhibitory domain (needs rb_foldtree)
			<MinMover name="rbmin_dock" scorefxn="ref_cst" chi="0" bb="0" jump="1"/>
			Cartesian minimization of the linker
			<TaskAwareMinMover name="linker_cartmin" scorefxn="ref_cst_cart" chi="1" bb="1" jump="0" cartesian="1" task_operations="init,inccurrent,ex,designlinkeronly"/>
						
		Foldtree stuff
		<DeclareBond name="connectchains" res1="406" res2="407" atom1="C" atom2="N"/>
		<AtomTree name="chem_foldtree" fold_tree_file="%%prefix%%_chem.ft"/>
		<AtomTree name="rb_foldtree" fold_tree_file="%%prefix%%_rb.ft"/>
				
		Parsed protocols
		<ParsedProtocol name="designsequence">
			Pack and min around the docked chain, with design on the docked chain.
			<Add mover_name="designchainb"/>
			<Add mover_name="minchainb"/>
		</ParsedProtocol>
	</MOVERS>
		
	<PROTOCOLS>
		<Add mover_name="a_k177a"/>
		Connect chains A and B, and reset the foldtree.
		<Add mover_name="favournative"/>
		<Add mover_name="connectchains"/>
		<Add mover_name="chem_foldtree"/>
		
		Add match constraints, and do an initial pack and min.
		<Add mover_name="addmatchcsts"/>
		Add filter_name="cstE_start"/>
		<Add mover_name="packcatalytic"/>
		<Add mover_name="mincatalytic"/>
		<Add filter_name="cstE"/>
		<Add filter_name="total"/>
		
		---This is taken over by posthbnet when used.---
		Design the inhibitor domain (chain B) and repack around.
		<Add mover_name="designsequence"/>
		<Add mover_name="designsequence"/>
					
		Final filters.
		<Add filter_name="cstE"/>
		<Add filter_name="contactcount"/>
		<Add filter_name="buriedhbonds"/>
		<Add filter_name="total"/>
		<Add filter_name="farep"/>
	</PROTOCOLS>
	
	<OUTPUT scorefxn="ref_cst_output"/>
</ROSETTASCRIPTS>
